import{a as f,o as d}from"./app.min.js";import"./preloader.min.js";class u{constructor(s){let e={viewpass:!1,autoHeight:!1,logging:!0,errorMesseges:{valueMissing:"Будь ласка, заповніть це поле.",validateName:{enterName:"Будь ласка, введіть Ваше ім’я.",containsNumbers:"Ім’я не може містити цифри.",containsOnlyAlphabet:"Ім’я може містити лише літери українського алфавіту та починатися з великої літери."},validateEmail:{enterEmail:"Будь ласка, введіть Ваш email",invalidEmail:{incorrectEmail:"Ви ввели некоректну єлектронну адресу",missingAtSymbol:t=>`Електронна адреса має містити символ "@". Єлектронна адреса "${t}" не містить символ "@"`}},validatePhone:{enterPhone:"Будь ласка, введіть Ваш номер телефону.",invalidPhone:{incorrectPhone:"Ви ввели некоректний номер."}},validateSelect:"Будь ласка, виберіть варіант зі списку."},reqexp:{name:/^[А-ЩЬЮЯЄІЇҐ][а-щьюяєіїґ']{1,29}(-[А-ЩЬЮЯЄІЇҐ][а-щьюяєіїґ']{1,29})?$/,email:/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,8})+$/,phone:/^\+38\(\d{3}\)[\s-]?\d{3}[\s-]?\d{2}[\s-]?\d{2}$/},on:{formSend:()=>{}}};this.config={...e,...s,errorMesseges:{...e.errorMesseges,...s?.errorMesseges},reqexp:{...e.reqexp,...s?.reqexp},on:{...e.on,...s?.on}},this.formAttributes={required:"data-required",validate:"data-validate",noValidate:"data-no-validate",noFocusClasses:"data-no-focus-classes",modalMessage:"data-modal-message",gotoError:"data-goto-error",autoHeight:"data-autoheight",autoHeightMin:"data-autoheight-min",autoHeightMax:"data-autoheight-max",error:"data-error",ajax:"data-ajax",dev:"data-dev"},this.formClasses={formFocus:"form-focus",formSuccess:"form-success",formError:"form-error",formSending:"form-sending",viewPass:"viewpass",viewPassActive:"viewpass-active"},this.eventsForm(),this.config.autoHeight&&this.autoHeight()}eventsForm(){document.addEventListener("focusin",({target:s})=>this.focusIn(s)),document.addEventListener("focusout",({target:s})=>this.focusOut(s)),document.addEventListener("change",({target:s})=>this.inputChange(s)),document.addEventListener("selectCallback",({detail:s})=>this.selectChange(s)),this.config.viewpass&&document.addEventListener("click",({target:s})=>this.inputViewPass(s)),document.addEventListener("submit",s=>this.formSubmit(s))}formSubmit(s){const e=s.target.closest("[data-form]");e&&this.formSubmitAction(e,s)}async formSubmitAction(s,e){if(e.preventDefault(),(s.hasAttribute(this.formAttributes.noValidate)?0:this.getErrorField(s))!==0){if(s.querySelector(this.formClasses.formError)&&s.hasAttribute(this.formAttributes.gotoError)){const o=s.dataset.gotoError||".form-error";f(o,{noHeader:!0,speed:1e3})}return}const r=s.hasAttribute(this.formAttributes.ajax),i=s.hasAttribute(this.formAttributes.dev);try{if(r){const o=s.getAttribute("action")?s.getAttribute("action").trim():"#",c=s.getAttribute("method")?s.getAttribute("method").trim():"GET",h=new FormData(s);s.classList.add(this.formClasses.formSending);const a=await fetch(o,{method:c,body:c!=="GET"?h:null});if(!a.ok){const l="Щось пішло не так!";throw new Error(l)}const n=await a.json();this.formSending(s,n)}i&&this.formSending(s)}catch(o){this.#e(o)}finally{s.classList.remove(this.formClasses.formSending)}}formSending(s,e=""){document.dispatchEvent(new CustomEvent("formSent",{detail:{form:s}})),setTimeout(()=>{if(d.modal){const{modalMessage:t}=s.dataset;t&&d.modal.open(t)}},0),this.config.on.formSend(s),this.formClean(s),this.#e("Form send!")}formClean(s){s.reset(),setTimeout(()=>{const e=s.querySelectorAll("input,textarea"),t=s.querySelectorAll("input[type=checkbox]"),r=s.querySelectorAll("input[type=radio]");if(e.length>0&&e.forEach(i=>{this.removeFieldError(i),this.removeFieldSuccess(i)}),t.length>0&&t.forEach(i=>i.checked=!1),r.length>0&&r.forEach(i=>i.checked=!1),d.select){const i=s.querySelectorAll("div.select");i.length>0&&i.forEach(o=>{const c=o.querySelector("select"),{options:h,multiple:a}=c;this.removeSelectFieldError(o,c),this.removeSelectFieldSuccess(o,c),Array.from(h).forEach((n,l)=>{a?n.removeAttribute("selected"):l===0?n.setAttribute("selected",""):n.removeAttribute("selected")}),d.select.selectBuild(c)})}},0)}inputViewPass(s){if(s.closest(`[class*="__${this.formClasses.viewPass}"]`)){const e=s.closest(`[class*="__${this.formClasses.viewPass}"]`);let t=e.classList.contains(this.formClasses.viewPassActive)?"password":"text";e.parentElement.querySelector("input").setAttribute("type",t),e.classList.toggle(this.formClasses.viewPassActive)}}autoHeight(){const s=document.querySelectorAll(`textarea[${this.formAttributes.autoHeight}]`);s.length>0&&s.forEach(e=>{const t=e.hasAttribute(this.formAttributes.autoHeightMin)?+e.dataset.autoheightMin:+e.offsetHeight,r=e.hasAttribute(this.formAttributes.autoHeightMax)?+e.dataset.autoheightMax:1/0;this.#s(e,Math.min(t,r)),e.addEventListener("input",()=>{e.scrollHeight>t&&(e.style.height="auto",this.#s(e,Math.min(Math.max(e.scrollHeight,t),r)))})})}#s(s,e){s.style.height=`${e}px`}inputChange(s){const{type:e}=s;(e==="checkbox"||e==="radio")&&this.validateField(s)}focusIn(s){const{tagName:e}=s;(e==="INPUT"||e==="TEXTAREA")&&(s.hasAttribute(this.formAttributes.noFocusClasses)||(s.classList.add(this.formClasses.formFocus),s.parentElement.classList.add(this.formClasses.formFocus)),s.hasAttribute(this.formAttributes.validate)&&this.removeFieldError(s))}focusOut(s){const{tagName:e}=s;(e==="INPUT"||e==="TEXTAREA")&&(s.hasAttribute(this.formAttributes.noFocusClasses)||(s.classList.remove(this.formClasses.formFocus),s.parentElement.classList.remove(this.formClasses.formFocus)),s.hasAttribute(this.formAttributes.validate)&&this.validateField(s))}selectChange(s){const{select:e}=s;e&&this.validateField(e)}getErrorField(s){let e=0;const t=s.querySelectorAll(`*[${this.formAttributes.required}]`);return t.length>0&&t.forEach(r=>{(r.offsetParent!==null||r.tagName==="SELECT")&&!r.disabled&&(e+=this.validateField(r))}),e}validateField(s){const{required:e}=s.dataset,{type:t,tagName:r}=s;let i=0;if(e==="name"){if(!s.value.trim()){this.removeFieldSuccess(s),this.addFieldError(s,this.config.errorMesseges.validateName.enterName),i++;return}if(this.#o(s)){this.removeFieldSuccess(s),this.addFieldError(s,this.config.errorMesseges.validateName.containsNumbers),i++;return}this.#t(s)?(this.removeFieldSuccess(s),this.addFieldError(s,this.config.errorMesseges.validateName.containsOnlyAlphabet),i++):(this.removeFieldError(s),this.addFieldSuccess(s))}if(e==="email"){if(!s.value.trim()){this.removeFieldSuccess(s),this.addFieldError(s,this.config.errorMesseges.validateEmail.enterEmail),i++;return}s.value=s.value.replace(" ",""),this.#i(s)?(this.removeFieldSuccess(s),this.addFieldError(s,this.config.errorMesseges.validateEmail.invalidEmail.incorrectEmail),s.value.includes("@")||this.addFieldError(s,this.config.errorMesseges.validateEmail.invalidEmail.missingAtSymbol(s.value)),i++):(this.removeFieldError(s),this.addFieldSuccess(s))}if(e==="phone"){if(!s.value.trim()){this.removeFieldSuccess(s),this.addFieldError(s,this.config.errorMesseges.validatePhone.enterPhone),i++;return}s.value=s.value.replace(" ",""),this.#r(s)?(this.addFieldError(s,this.config.errorMesseges.validatePhone.invalidPhone.incorrectPhone),this.removeFieldSuccess(s),i++):(this.removeFieldError(s),this.addFieldSuccess(s))}if(t==="checkbox"&&(s.checked?(this.removeFieldError(s),this.addFieldSuccess(s)):(this.addFieldError(s,this.config.errorMesseges.valueMissing),this.removeFieldSuccess(s),i++)),t==="radio"){const{name:o}=s,c=document.querySelectorAll(`input[name="${o}"]`),h=Array.from(c).some(l=>l.checked),a=s.closest("fieldset")||s.parentElement,n=a.querySelector(".form__error");if(n&&a.removeChild(n),h)c.forEach(l=>{this.removeFieldError(l),this.addFieldSuccess(l)}),a.classList.contains(this.formClasses.formError)&&a.classList.remove(this.formClasses.formError);else{if(!n&&a.hasAttribute(this.formAttributes.error)){const{error:l}=a.dataset;a.insertAdjacentHTML("beforeend",this.getFormErrorHTML(l,this.config.errorMesseges.valueMissing))}c.forEach(l=>{this.addFieldError(l),this.removeFieldSuccess(l)}),a.classList.contains(this.formClasses.formError)||a.classList.add(this.formClasses.formError),i++}}if(d.select&&r==="SELECT"){const o=s.parentElement;s.multiple?Array.from(s.selectedOptions).filter(h=>h.value).length?(this.removeSelectFieldError(o,s),this.addSelectFieldSuccess(o,s)):(this.removeSelectFieldSuccess(o,s),this.addSelectFieldError(o,s,this.config.errorMesseges.validateSelect),i++):s.value.trim()?(this.removeSelectFieldError(o,s),this.addSelectFieldSuccess(o,s)):(this.removeSelectFieldSuccess(o,s),this.addSelectFieldError(o,s,this.config.errorMesseges.validateSelect),i++)}return r!=="SELECT"&&t!=="checkbox"&&t!=="radio"&&e===""&&(s.value.trim()?(this.removeFieldError(s),this.addFieldSuccess(s)):(this.removeFieldSuccess(s),this.addFieldError(s,this.config.errorMesseges.valueMissing),i++)),i}addSelectFieldError(s,e,t=""){const r=s.parentElement,i=r?.querySelector(".form__error");if(i&&r.removeChild(i),this.formFieldsToggleErrorClass(s,r,!0),this.formFieldSetInvalidAttr(e),this.formFieldSetInvalidAttr(s),e.hasAttribute(this.formAttributes.error)){const{error:o}=e.dataset;r.insertAdjacentHTML("beforeend",this.getFormErrorHTML(o,t))}}removeSelectFieldError(s){const e=s.parentElement,t=e?.querySelector(".form__error");t&&e.removeChild(t),this.formFieldsToggleErrorClass(s,e)}addSelectFieldSuccess(s,e){const t=s.parentElement;this.formFieldsToggleSuccessClass(s,t,!0),this.formFieldSetInvalidAttr(e,!1),this.formFieldSetInvalidAttr(s,!1)}removeSelectFieldSuccess(s){const e=s.parentElement;this.formFieldsToggleSuccessClass(s,e)}addFieldError(s,e=""){const t=s.parentElement,r=t.querySelector(".form__error");if(r&&t.removeChild(r),this.formFieldsToggleErrorClass(s,t,!0),this.formFieldSetInvalidAttr(s),s.hasAttribute(this.formAttributes.error)){const{error:i}=s.dataset;t.insertAdjacentHTML("beforeend",this.getFormErrorHTML(i,e))}}removeFieldError(s){const e=s.parentElement,t=e.querySelector(".form__error");this.formFieldsToggleErrorClass(s,e),t&&e.removeChild(t)}addFieldSuccess(s){const e=s.parentElement;this.formFieldsToggleSuccessClass(s,e,!0),this.formFieldSetInvalidAttr(s,!1)}removeFieldSuccess(s){const e=s.parentElement;this.formFieldsToggleSuccessClass(s,e)}formFieldSetInvalidAttr(s,e=!0){s.setAttribute("aria-invalid",`${!!e}`)}formFieldsToggleSuccessClass(s,e,t=!1){t?(s.classList.add(this.formClasses.formSuccess),e.classList.add(this.formClasses.formSuccess)):(s.classList.remove(this.formClasses.formSuccess),e.classList.remove(this.formClasses.formSuccess))}formFieldsToggleErrorClass(s,e,t=!1){t?(s.classList.add(this.formClasses.formError),e.classList.add(this.formClasses.formError)):(s.classList.remove(this.formClasses.formError),e.classList.remove(this.formClasses.formError))}getFormErrorHTML(s,e){return`<div class="form__error">${s||e}</div>`}#t(s){return!this.config.reqexp.name.test(s.value)}#i(s){return!this.config.reqexp.email.test(s.value)}#r(s){return!this.config.reqexp.phone.test(s.value)}#o(s){return/\d/.test(s.value)}#e(s){this.config.logging&&console.log(`[Форми]: ${s}`)}}d.formsValidation=new u({reqexp:{name:/^[A-Za-z]+([ -][A-Za-z]+)*$/}});
